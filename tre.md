**สแต็กที่ผมแนะนำ**
- แกนเชื่อม MT5: `MetaTrader5` (Python package ทางการ)  
  เหตุผล: ตรงไปตรงมา, เรียกฟังก์ชัน MT5 ได้ครบ, เหมาะกับ D1 ที่ไม่ต้อง async หนัก
- ชั้นคำนวณสัญญาณ: `pandas`, `numpy`, (ถ้าจะใช้) `pandas-ta` หรือ `ta-lib`
- ชั้นจัดการระบบ: `pydantic` (ตรวจ input/params), `loguru` หรือ logging, เก็บสถานะด้วย `sqlite` (กันยิงซ้ำ)
- การแจ้งเตือน/ยืนยันออเดอร์ (ถ้าต้องการ): Telegram/LINE notify หรือทำ CLI confirm ก่อนก็ได้

**โครงสร้างที่ควรทำ (สำคัญมาก)**
- แยก 2 ส่วนชัดเจน
  1) **Signal Engine**: อ่านข้อมูล → คำนวณ → ออก “คำแนะนำ” (BUY/SELL/NO TRADE, SL/TP, risk)
  2) **Execution Engine**: รับคำแนะนำ → ตรวจ risk & เงื่อนไข → ส่งออเดอร์/หรือรอคนยืนยัน
- ทำ 3 โหมดสลับได้ด้วย config:
  - `DRY_RUN`: คำนวณ+บันทึก+แจ้งเตือน แต่ไม่ส่งออเดอร์
  - `MANUAL_CONFIRM`: สร้าง “ตั๋วคำสั่ง” แล้วให้คนกดยืนยันก่อนส่ง
  - `AUTO`: ส่งออเดอร์อัตโนมัติ (แต่ต้องมีเพดานความเสี่ยง/kill switch)

**Workflow ที่เข้ากับ D1**
- ทำงาน “วันละครั้ง” หลังแท่ง D1 ปิด (เลือกเวลาตามโบรกเกอร์/เซิร์ฟเวอร์)
- ขั้นตอนรอบหนึ่ง:
  1) ดึงแท่ง D1 ล่าสุด + N แท่งย้อนหลัง
  2) คำนวณสัญญาณ
  3) เช็คเงื่อนไขความเสี่ยง + สถานะ position เดิม (กันซ้อน)
  4) ถ้า `MANUAL_CONFIRM`: ส่งข้อความสรุป (entry/SL/TP/lot) ให้คุณกดยืนยัน
  5) ถ้า `AUTO`: ส่งออเดอร์ + บันทึก ticket + ทำ log

**กติกาความเสี่ยงขั้นต่ำที่ควรล็อก**
- Risk ต่อไม้: เช่น 0.5%–1% ของ equity (คุณกำหนด)
- จำกัดจำนวน position ต่อสัญลักษณ์: 1 ไม้/สัญลักษณ์
- จำกัดจำนวนไม้ต่อวัน: เช่น 0–1 ต่อสัญลักษณ์
- กำหนด `max_slippage`, `max_spread` (ถ้าดึงได้), และ “ไม่เทรดช่วงข่าวแรง” (ถ้าคุณมีปฏิทิน)
- Kill switch: ถ้าขาดทุนสะสมเกิน X ต่อวัน/สัปดาห์ให้หยุด

**ขั้นตอนเริ่มต้นแบบเร็ว (ให้ได้ระบบใช้งานจริง)**
1) ติดตั้ง MT5 Terminal บน Windows + ล็อกอินบัญชีเดโม
2) ติดตั้ง Python 3.11+
3) ติดตั้งแพ็กเกจ: `pip install MetaTrader5 pandas numpy pydantic loguru` (+ `pandas-ta` ถ้าจะใช้)
4) ทำสคริปต์ “connect + ดึง D1 + print สัญญาณ” ให้ผ่านก่อน
5) ทำ “โหมด DRY_RUN” และ log/บันทึกสัญญาณอย่างน้อย 2–4 สัปดาห์
6) ค่อยเปิด `MANUAL_CONFIRM` บนเดโม
7) ค่อยเปิด `AUTO` เฉพาะหลังคุณมั่นใจเรื่อง risk + error handling

-------------------------------------------------------------------------------

จะรวบรวม “กลยุทธ์ยอดนิยม” ที่คนใช้กันจริง แล้วสรุปเป็นกฎเข้า/ออก พร้อมสูตรคำนวณตัวชี้วัดที่จำเป็น (เน้นใช้ได้กับ D1 และทำเป็นบอทได้) ครับ


**กลยุทธ์ยอดนิยมที่คนใช้กันบ่อย (พร้อมกฎ + สูตรคำนวณ)**  
ด้านล่างเป็น “แม่แบบ” ที่ทำเป็นบอทได้เลย (เชิงการศึกษา ไม่การันตีกำไร) และเหมาะกับกรอบเวลา D1 มาก เพราะสัญญาณไม่ถี่และสัญญาณหลอกน้อยกว่าช่วงสั้น

---

**1) Trend Following: Moving Average Crossover (ตามเทรนด์แบบง่าย)**
- แนวคิด: เทรนด์ขึ้นเมื่อเส้นเร็วตัดขึ้นเส้นช้า
- กฎ (ตัวอย่าง)
  - เข้า Long: `EMA_fast` ตัดขึ้น `EMA_slow` และปิดแท่งยืนเหนือทั้งคู่
  - ออก Long: `EMA_fast` ตัดลง `EMA_slow` หรือปิดต่ำกว่า `EMA_slow`
  - (Short ก็กลับทิศ)
- สูตร
  - $EMA_t = \alpha P_t + (1-\alpha) EMA_{t-1}$, $\alpha=\frac{2}{n+1}$
  - ถ้าใช้ SMA: $SMA_t = \frac{1}{n}\sum_{i=0}^{n-1} P_{t-i}$
- ทิปสำหรับ D1: ใช้ค่าจาก “แท่งที่ปิดแล้ว” เท่านั้น (ไม่ใช้แท่งกำลังก่อตัว)

---

**2) Trend Following: Donchian Channel / Turtle Breakout (เบรกเอาท์ตามเทรนด์)**
- แนวคิด: ถ้าราคาทะลุ “จุดสูงสุด N วัน” แปลว่าเริ่มเทรนด์
- กฎ (เวอร์ชันคลาสสิก)
  - เข้า Long: Close ทะลุ `HighestHigh(N)` ของ N วันที่ผ่านมา (มักใช้ 20 หรือ 55)
  - ออก Long: Close หลุด `LowestLow(M)` (มักใช้ 10 หรือ 20)
  - Stop: ใช้ ATR-based stop (เช่น 2×ATR)
- สูตร
  - $DonchianUpper_t = \max(High_{t-N+1..t})$
  - $DonchianLower_t = \min(Low_{t-N+1..t})$
- เหมาะกับ: ตลาดมีเทรนด์ชัด แต่จะเจอ “false breakout” ในช่วงไซด์เวย์

---

**3) Mean Reversion: Bollinger Bands (กลับเข้าหาค่าเฉลี่ย)**
- แนวคิด: ราคาออกนอกกรอบมาก ๆ แล้วมักย้อนกลับเข้ากลาง (ใช้ได้ดีตอนตลาดแกว่ง)
- กฎ (ตัวอย่าง)
  - เข้า Long: Close < LowerBand และ (ตัวกรอง) RSI < 30
  - ออก Long: กลับมาที่ MiddleBand (SMA) หรือ RSI กลับ > 50
- สูตร Bollinger
  - $Middle_t = SMA(P, n)$
  - $Upper_t = Middle_t + k \cdot \sigma(P,n)$
  - $Lower_t = Middle_t - k \cdot \sigma(P,n)$
  - โดย $\sigma(P,n)$ คือส่วนเบี่ยงเบนมาตรฐานของราคาย้อนหลัง n แท่ง
- ข้อควรระวัง: ถ้าตลาด “ติดเทรนด์แรง” mean reversion มักโดนลาก

---

**4) RSI Swing / Overbought-Oversold (โมเมนตัม/แกว่งตัว)**
- กฎ (พื้นฐาน)
  - เข้า Long: RSI < 30 แล้วกลับขึ้น (เช่น RSI ตัดขึ้น 30)
  - ออก Long: RSI > 50 หรือ > 70 แล้วเริ่มอ่อน
- สูตร RSI (Wilder)
  - $RSI = 100 - \frac{100}{1+RS}$
  - $RS = \frac{AvgGain}{AvgLoss}$
- ทิป: RSI ทำงานต่างกันใน “เทรนด์” vs “ไซด์เวย์” (ควรมีตัวกรองเทรนด์ เช่น MA หรือ ADX)

---

**5) MACD (ตามเทรนด์ + โมเมนตัม)**
- กฎ (นิยม)
  - เข้า Long: MACD line ตัดขึ้น Signal line และ/หรือ Histogram กลับเป็นบวก
  - ออก Long: ตัดลง หรือ Histogram กลับเป็นลบ
- สูตร
  - $MACD = EMA(P,12) - EMA(P,26)$
  - $Signal = EMA(MACD,9)$
  - $Histogram = MACD - Signal$

---

**6) ATR + Stop/Trailing Stop (ตัวคุมความเสี่ยงที่ “ควรมี” เกือบทุกกลยุทธ์)**
- ใช้กำหนดระยะ Stop ตามความผันผวน (เหมาะมากกับ D1)
- สูตร
  - $TR_t = \max(High_t-Low_t,\ |High_t-Close_{t-1}|,\ |Low_t-Close_{t-1}|)$
  - $ATR$ มักใช้ Wilder smoothing (คล้าย EMA แบบเฉพาะ)
- ตัวอย่างการใช้
  - Stop distance = $m \cdot ATR$ (เช่น $m=2$)
  - Trailing stop: ขยับ SL ตามจุดสูง/ต่ำ + ATR

---

**7) Supertrend (เทรนด์ + trailing stop ในตัว)**
- แนวคิด: ใช้ ATR สร้าง “เส้นตามเทรนด์” ให้ตัดสินใจง่าย
- สูตรแกนหลัก (เวอร์ชันทั่วไป)
  - $Mid = \frac{High+Low}{2}$
  - $Upper = Mid + Mult \cdot ATR$
  - $Lower = Mid - Mult \cdot ATR$
- กฎ (ทั่วไป)
  - เข้า Long: ราคาปิดเหนือเส้น Supertrend (และสี/สถานะเป็นขาขึ้น)
  - ออก: ปิดต่ำกว่าเส้น (กลับสถานะ)

---

**กฎคำนวณ “ขนาดสัญญา/lot” (สำคัญกว่าตัวอินดิเคเตอร์)**
- กำหนดความเสี่ยงต่อไม้เป็นเปอร์เซ็นต์ของทุน เช่น $r=1\%$
- สูตรพื้นฐาน
  - $RiskMoney = Equity \cdot r$
  - $PositionSize = \frac{RiskMoney}{StopDistance \cdot ValuePerPoint}$
- ใน Forex ต้องรู้ “มูลค่า pip ต่อ lot” ของสัญลักษณ์นั้น (MT5 ให้ข้อมูลนี้ได้)

---

**แนะนำให้เริ่ม 2 ระบบสำหรับ D1 (ครอบคลุมสภาพตลาด)**
- ระบบ A (เทรนด์): Donchian Breakout + ATR Stop/Trail
- ระบบ B (ไซด์เวย์): Bollinger Mean Reversion + RSI filter
- ใส่ตัวกรองสภาวะตลาด (ง่าย ๆ): ใช้ ADX หรือ MA slope เพื่อเลือกว่าจะเปิดระบบ A หรือ B
